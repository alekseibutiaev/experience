project(execution)

set(CXX_FLAGS_COMMON "${CXX_FLAGS_COMMON} -fno-exceptions -fno-rtti -Wno-return-type -Wno-comment\
    -Wno-unused-function -Wno-strict-aliasing")

set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} ${CXX_FLAGS_COMMON} -O0 -g3")
set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} ${CXX_FLAGS_COMMON} -O3 -g0 -DNDEBUG")

include_directories(
  ${v8source}/
  ${v8source}/include/
  ${v8source}/src
  ${CMAKE_BINARY_DIR}/v8build
  ${CMAKE_BINARY_DIR}/v8build/gen
  ${ICU_INCLUDE_DIRS}
)

set(${PROJECT_NAME}_headers
  ${v8source}/src/execution/arguments-inl.h
  ${v8source}/src/execution/arguments.h
  ${v8source}/src/execution/execution.h
  ${v8source}/src/execution/frame-constants.h
  ${v8source}/src/execution/frames-inl.h
  ${v8source}/src/execution/frames.h
  ${v8source}/src/execution/futex-emulation.h
  ${v8source}/src/execution/interrupts-scope.h
  ${v8source}/src/execution/isolate-data.h
  ${v8source}/src/execution/isolate-inl.h
  ${v8source}/src/execution/isolate-utils.h
  ${v8source}/src/execution/isolate.h
  ${v8source}/src/execution/messages.h
  ${v8source}/src/execution/microtask-queue.h
  ${v8source}/src/execution/protectors-inl.h
  ${v8source}/src/execution/protectors.h
  ${v8source}/src/execution/runtime-profiler.h
  ${v8source}/src/execution/simulator-base.h
  ${v8source}/src/execution/simulator.h
  ${v8source}/src/execution/stack-guard.h
  ${v8source}/src/execution/thread-id.h
  ${v8source}/src/execution/thread-local-top.h
  ${v8source}/src/execution/v8threads.h
  ${v8source}/src/execution/vm-state-inl.h
  ${v8source}/src/execution/vm-state.h
  ${v8source}/src/execution/ia32/frame-constants-ia32.h
  ${v8source}/src/execution/x64/frame-constants-x64.h
  ${v8source}/src/execution/arm/frame-constants-arm.h
  ${v8source}/src/execution/arm/simulator-arm.h
  ${v8source}/src/execution/arm64/frame-constants-arm64.h
  ${v8source}/src/execution/arm64/simulator-arm64.h
  ${v8source}/src/execution/mips/frame-constants-mips.h
  ${v8source}/src/execution/mips/simulator-mips.h
  ${v8source}/src/execution/mips64/frame-constants-mips64.h
  ${v8source}/src/execution/mips64/simulator-mips64.h
  ${v8source}/src/execution/ppc/frame-constants-ppc.h
  ${v8source}/src/execution/ppc/simulator-ppc.h
  ${v8source}/src/execution/s390/frame-constants-s390.h
  ${v8source}/src/execution/s390/simulator-s390.h
)

set(${PROJECT_NAME}_sources
  ${v8source}/src/execution/arguments.cc
  ${v8source}/src/execution/execution.cc
  ${v8source}/src/execution/frames.cc
  ${v8source}/src/execution/futex-emulation.cc
  ${v8source}/src/execution/interrupts-scope.cc
  ${v8source}/src/execution/isolate.cc
  ${v8source}/src/execution/messages.cc
  ${v8source}/src/execution/microtask-queue.cc
  ${v8source}/src/execution/protectors.cc
  ${v8source}/src/execution/runtime-profiler.cc
  ${v8source}/src/execution/simulator-base.cc
  ${v8source}/src/execution/stack-guard.cc
  ${v8source}/src/execution/thread-id.cc
  ${v8source}/src/execution/thread-local-top.cc
  ${v8source}/src/execution/v8threads.cc
  ${v8source}/src/execution/ia32/frame-constants-ia32.cc
  ${v8source}/src/execution/x64/frame-constants-x64.cc
  ${v8source}/src/execution/arm/frame-constants-arm.cc
  ${v8source}/src/execution/arm/simulator-arm.cc
  ${v8source}/src/execution/arm64/frame-constants-arm64.cc
  ${v8source}/src/execution/arm64/pointer-auth-arm64.cc
  ${v8source}/src/execution/arm64/simulator-arm64.cc
  ${v8source}/src/execution/arm64/simulator-logic-arm64.cc
  ${v8source}/src/execution/mips/frame-constants-mips.cc
  ${v8source}/src/execution/mips/simulator-mips.cc
  ${v8source}/src/execution/mips64/frame-constants-mips64.cc
  ${v8source}/src/execution/mips64/simulator-mips64.cc
  ${v8source}/src/execution/ppc/frame-constants-ppc.cc
  ${v8source}/src/execution/ppc/simulator-ppc.cc
  ${v8source}/src/execution/s390/frame-constants-s390.cc
  ${v8source}/src/execution/s390/simulator-s390.cc
)

add_definitions(-DV8_USE_EXTERNAL_STARTUP_DATA)
add_definitions(-DV8_ENABLE_REGEXP_INTERPRETER_THREADED_DISPATCH)
add_definitions(-D__STDC_CONSTANT_MACROS)
add_definitions(-DV8_DEPRECATION_WARNINGS)
add_definitions(-DV8_EMBEDDED_BUILTINS)
add_definitions(-DENABLE_GDB_JIT_INTERFACE)
add_definitions(-DV8_SHARED_RO_HEAP)
add_definitions(-DUSING_V8_BASE_SHARED)
add_definitions(-DDISABLE_UNTRUSTED_CODE_MITIGATIONS)
add_definitions(-DV8_USE_SNAPSHOT)
add_definitions(-DENABLE_HANDLE_ZAPPING)
add_definitions(-DV8_31BIT_SMIS_ON_64BIT_ARCH)
add_definitions(-DOBJECT_PRINT)
add_definitions(-DENABLE_MINOR_MC)
add_definitions(-DVERIFY_HEAP)
add_definitions(-DV8_IMMINENT_DEPRECATION_WARNINGS)
add_definitions(-DNVALGRIND)
add_definitions(-DV8_TYPED_ARRAY_MAX_SIZE_IN_HEAP=64)
add_definitions(-D__STDC_FORMAT_MACROS)
add_definitions(-DV8_CONCURRENT_MARKING)
add_definitions(-DBUILDING_V8_SHARED)
add_definitions(-DV8_TARGET_OS_LINUX)
add_definitions(-DV8_ENABLE_LAZY_SOURCE_POSITIONS)
add_definitions(-DV8_INTL_SUPPORT)
add_definitions(-DV8_WIN64_UNWINDING_INFO)
add_definitions(-DV8_HAVE_TARGET_OS)
add_definitions(-D_GNU_SOURCE)
add_definitions(-DENABLE_DISASSEMBLER)

if(${ARCHITECTURE} STREQUAL "x86_64")
  add_definitions(-DV8_TARGET_ARCH_X64)
elseif(${ARCHITECTURE} STREQUAL "i386" OR ${ARCHITECTURE} STREQUAL "i486" OR ${ARCHITECTURE} STREQUAL "i586"  OR ${ARCHITECTURE} STREQUAL "i686")
  add_definitions(V8_TARGET_ARCH_IA32)
endif()

add_library(${PROJECT_NAME}_obj OBJECT ${${PROJECT_NAME}_sources} ${${PROJECT_NAME}_headers})

add_library(${PROJECT_NAME}_obj_pic OBJECT ${${PROJECT_NAME}_sources} ${${PROJECT_NAME}_headers})
set_property(TARGET ${PROJECT_NAME}_obj_pic PROPERTY POSITION_INDEPENDENT_CODE 1)

add_dependencies(${PROJECT_NAME}_obj
  rename_debug
  bytecodes-builtins-list
  tq_files
)

add_dependencies(${PROJECT_NAME}_obj_pic
  rename_debug
  bytecodes-builtins-list
  tq_files
)

